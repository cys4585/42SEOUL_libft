# 라이브러리

# 라이브러리

- 다른 프로그램들과 링크되기 위하여 존재하는, 하나 이상의 서브루틴(subroutine)이나 함수(function)들의 집합 파일
- 라이브러리들은 사용자의 프로그램과 링크되어 실행이 가능한 완전한 프로그램을 이룬다.

# 정적 라이브러리

- 프로그램 빌드 시에 라이브러리가 제공하는 코드를 실행 파일에 넣는 방식의 라이브러리
- 컴파일된 오브젝트 파일들이 하나의 archive로 묶여있는 형태
- 빌드 과정 중 링크 단계에서 실행 파일에 결합된다.
    - 빌드 과정
        - 
            
            [https://camo.githubusercontent.com/3b57523ce53cd796bdb41a0aa5902db62d8d1da8a378ae1f8453b823d40e6978/68747470733a2f2f626c6f672e6b616b616f63646e2e6e65742f646e2f783878504c2f62747130486162634a41682f6e35724375476a7a705574796e624469336e30306d302f696d672e706e67](https://camo.githubusercontent.com/3b57523ce53cd796bdb41a0aa5902db62d8d1da8a378ae1f8453b823d40e6978/68747470733a2f2f626c6f672e6b616b616f63646e2e6e65742f646e2f783878504c2f62747130486162634a41682f6e35724375476a7a705574796e624469336e30306d302f696d672e706e67)
            
        - `//STEP1. 전처리 단계 [ *.c -> *.i ]
        gcc -E main.c -o main.i
        gcc -E func.c -o func.i
        //STEP2. ~ 컴파일 단계 [ *.c -> (*.i) -> *.s ]
        gcc -S main.c func.c
        //STEP3. ~ 어셈블 단계 [ *.c -> (*.i) -> (*.s) -> *.o ]
        gcc -c main.c func.c
        //STEP4. ~ 링크 단계 [ *.c -> (*.i) -> (*.s) -> (*.o) -> executable ]
        gcc -o main main.c func.c`
- 장점
    - 라이브러리의 동작 코드가 이를 사용하는 실행 바이너리 속에 포함되기 때문에 별도의 추가작업 없이, 그리고 독립적으로 라이브러리 함수들을 사용할 수 있다.
    - 시스템 환경이 변해도 애플리케이션에 아무런 영향이 없고, 완성된 애플리케이션을 안정적으로 사용할 수 있다.
    - 컴파일시 필요한 라이브러리를 프로그램 내에 적재하기 때문에 이식성이 좋다.
    - 런타임시 외부를 참조할 필요가 없기 때문에 속도에서 장점이 있다.
- 단점
    - 사용하는 모든 오브젝트 코드를 실행 파일에 내장하기 때문에 메모리에 로드되는 애플리케이션 코드 크기가 커진다.
    - 라이브러리 변경이 필요할 시, 변경된 라이브러리만 재배포하면 안되고, 프로그램을 다시 재배포 해야한다.
- 확장자: `.a` / `.lib`
- 정적 라이브러리 만들기
    - `.c` 파일들을 각각 `.o` 파일(오브젝트 파일)로 만든다 -> 오브젝트 파일들을 하나의 `.a` 파일(아카이브 파일)로 만든다 -> 사용할 때는 빌드할 때 -L, -l 플래그로 라이브러리를 포함한다.
    - `# 라이브러리 만들기
    gcc -c my.c
    ar rcs libmy.a my.o
    # 실행파일(test) 빌드할 떄 라이브러리(libmy.a) 포함하기 (lib[이름].a)
    gcc -o test test.c -L./ -lmy	# -L경로 -l이름
    # 그냥 이렇게 해도 됨 ㅎㅎ
    gcc -o test test.c libmy.a`
    - `gcc`: c 언어 컴파일러 (GNU C Compiler / GNU Compiler Collection)
        - options
            - `c`: 소스파일을 컴파일or어셈블하도록 컴파일러에 지시하지만, 링크는 하지 않는다. (출력물은 각 소스파일들의 오브젝트 파일 `.o`)
            - `o`: 아웃풋 파일이름
    - `ar`: 아카이브 생성, 수정 및 추출 (라이브러리 조작 명령어)
        - Archive: 기록보관소. 파일들을 한 곳에 모아둔 것 (라이브러리라고 생각하면 편할 듯)
        - options
            - `r`
                - 파일 멤버를 아카이브에 삽입 (교체 포함)
                - 새로운 오브젝트 파일이면 추가, 기존 파일이면 교체
            - `c`
                - 아카이브(라이브러리) 생성
                - 존재하지 않는 아카이브를 작성or갱신하는 경우에 경고하지 않는다.
            - `s`
                - 아카이브 인덱스를 생성
                - 아카이브 인덱스를 생성하지 않으면 링크 속도가 느려지고, 시스템 환경에 따라서는 에러가 발생.